# Flex compiler

## Сборка компилятора и запуск
```bash
$ cd grammar
$ make
$ ./flex-compiler <путь до файла с кодом>
```

## Грамматика
```
<Программа> ::= <Объявление переменных> <Описание вычислений>
<Описание вычислений> ::= <Список операторов>
<Объявление переменных> ::= var <Список переменных> ;
<Список переменных> ::= <Идент> | <Идент> , <Список переменных>
<Список операторов> ::= <Оператор> | <Оператор> <Список операторов>
<Оператор> ::= <Присваивание> | <Сложный оператор>
<Присваивание> ::= <Идент> = <Выражение> ;
<Выражение> ::= <Ун.оп.> <Подвыражение> | <Подвыражение>
<Подвыражение> ::= ( <Выражение> ) | <Операнд> | <Подвыражение> <Бин.оп.> <Подвыражение>
<Ун.оп.> ::= "-"
<Бин.оп.> ::= "-" | "+" | "*" | "/" | "<" | ">" | "===="
<Операнд> ::= <Идент> | <Const>
<Сложный оператор> ::= if <Выражение> then <Оператор> 
                       | if <Выражение> then <Оператор> else <Оператор> 
                       | <Составной оператор>
<Составной оператор> ::= { <Список операторов> }
<Идент> ::= <Буква> <Идент> | <Буква>
<Const> ::= <Цифра> <Const> | <Цифра>
```

## Ассемблер, генерируемый компилятором

- `goto label` - переход к метке `label`
- `label:` - метка
- `X = Y op Z` - выражение, где результат вычисления выражения `Y op Z` записывается в `X`
- `cmptrue var label` - если `var` истина, то выполняется инструкция, которая идет сразу после `cmptrue`, если ложь,
то происходит переход на метку `label`

## Пример работы
**Исходный файл:**
```
var a, b, c, d;
a = 1;
b = 2;
c = 3;
d = 4;

if (((a - b) + 3) > 0) then {
    b = (-a) + 2;
}
else {
    d = c / 3;
    b = 2 + a * 2;
}

c = c + 2;
```
**Сгенерированные дерево и "ассемблерный" код:**
```
+------[Program body](NULL)
                                                        +------[Const](2)
                                                 +------[Expression](+)
                                                        +------[Identifier](c)
                                          +------[Operator](=)
                                                 +------[Identifier](c)
                                   +------[Operators](NULL)
                                                                                    +------[Const](2)
                                                                             +------[Expression](*)
                                                                                    +------[Identifier](a)
                                                                      +------[Expression](+)
                                                                             +------[Const](2)
                                                               +------[Operator](=)
                                                                      +------[Identifier](b)
                                                        +------[Operators](NULL)
                                                                             +------[Const](3)
                                                                      +------[Expression](/)
                                                                             +------[Identifier](c)
                                                               +------[Operator](=)
                                                                      +------[Identifier](d)
                                                 +------[FlowOp](NULL)
                                                                      +------[Const](2)
                                                               +------[Expression](+)
                                                                             +------[Identifier](a)
                                                                      +------[Expression](U)
                                                        +------[Operator](=)
                                                               +------[Identifier](b)
                                          +------[FlowIfElse](NULL)
                                                        +------[Const](0)
                                                 +------[Expression](>)
                                                               +------[Const](3)
                                                        +------[Expression](+)
                                                                      +------[Identifier](b)
                                                               +------[Expression](-)
                                                                      +------[Identifier](a)
                            +------[Operators](NULL)
                                          +------[Const](4)
                                   +------[Operator](=)
                                          +------[Identifier](d)
                     +------[Operators](NULL)
                                   +------[Const](3)
                            +------[Operator](=)
                                   +------[Identifier](c)
              +------[Operators](NULL)
                            +------[Const](2)
                     +------[Operator](=)
                            +------[Identifier](b)
       +------[Operators](NULL)
                     +------[Const](1)
              +------[Operator](=)
                     +------[Identifier](a)
[Root](NULL)
                            +------[VarList](d)
                     +------[VarList](c)
              +------[VarList](b)
       +------[VarList](a)
+------[VarDecl](NULL)

a = 1
b = 2
c = 3
d = 4
tmp2 = a - b
tmp1 = tmp2 + 3
tmp0 = tmp1 > 0
cmptrue tmp0 L0
tmp4 = -a
tmp3 = tmp4 + 2
b = tmp3
goto L1
L0:
tmp5 = c / 3
d = tmp5
tmp7 = a * 2
tmp6 = 2 + tmp7
b = tmp6
L1:
tmp8 = c + 2
c = tmp8
```